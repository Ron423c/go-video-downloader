// Code generated by transpiler. DO NOT EDIT.

/**
 * Go Video Downloader
 *
 *    Copyright 2019 Tenta, LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * For any questions, please contact developer@tenta.io
 *
 * instagram/module.go: transpiled from https://github.com/ytdl-org/youtube-dl/blob/master/youtube_dl/extractor/instagram.py
 */

package instagram

import (
	Ωre "github.com/tenta-browser/go-video-downloader/gen/re"
	Ωcompat "github.com/tenta-browser/go-video-downloader/gen/youtube_dl/compat"
	Ωcommon "github.com/tenta-browser/go-video-downloader/gen/youtube_dl/extractor/common"
	Ωutils "github.com/tenta-browser/go-video-downloader/gen/youtube_dl/utils"
	λ "github.com/tenta-browser/go-video-downloader/runtime"
)

var (
	ExtractorError            λ.Object
	InfoExtractor             λ.Object
	InstagramIE               λ.Object
	InstagramPlaylistIE       λ.Object
	InstagramTagIE            λ.Object
	InstagramUserIE           λ.Object
	ϒcompat_str               λ.Object
	ϒget_element_by_attribute λ.Object
	ϒint_or_none              λ.Object
	ϒlowercase_escape         λ.Object
	ϒstd_headers              λ.Object
	ϒtry_get                  λ.Object
	ϒurl_or_none              λ.Object
)

func init() {
	λ.InitModule(func() {
		InfoExtractor = Ωcommon.InfoExtractor
		ϒcompat_str = Ωcompat.ϒcompat_str
		ExtractorError = Ωutils.ExtractorError
		ϒget_element_by_attribute = Ωutils.ϒget_element_by_attribute
		ϒint_or_none = Ωutils.ϒint_or_none
		ϒlowercase_escape = Ωutils.ϒlowercase_escape
		ϒstd_headers = Ωutils.ϒstd_headers
		ϒtry_get = Ωutils.ϒtry_get
		ϒurl_or_none = Ωutils.ϒurl_or_none
		InstagramIE = λ.Cal(λ.TypeType, λ.StrLiteral("InstagramIE"), λ.NewTuple(InfoExtractor), func() λ.Dict {
			var (
				InstagramIE__VALID_URL    λ.Object
				InstagramIE__real_extract λ.Object
			)
			InstagramIE__VALID_URL = λ.StrLiteral("(?P<url>https?://(?:www\\.)?instagram\\.com/(?:p|tv)/(?P<id>[^/?#&]+))")
			InstagramIE__real_extract = λ.NewFunction("_real_extract",
				[]λ.Param{
					{Name: "self"},
					{Name: "url"},
				},
				0, false, false,
				func(λargs []λ.Object) λ.Object {
					var (
						ϒcomment_count  λ.Object
						ϒcomments       λ.Object
						ϒdescription    λ.Object
						ϒedge           λ.Object
						ϒedge_num       λ.Object
						ϒedges          λ.Object
						ϒentries        λ.Object
						ϒformats        λ.Object
						ϒget_count      λ.Object
						ϒheight         λ.Object
						ϒlike_count     λ.Object
						ϒmedia          λ.Object
						ϒmobj           λ.Object
						ϒnode           λ.Object
						ϒnode_video_url λ.Object
						ϒself           = λargs[0]
						ϒshared_data    λ.Object
						ϒthumbnail      λ.Object
						ϒtimestamp      λ.Object
						ϒuploader       λ.Object
						ϒuploader_id    λ.Object
						ϒurl            = λargs[1]
						ϒvideo_id       λ.Object
						ϒvideo_url      λ.Object
						ϒwebpage        λ.Object
						ϒwidth          λ.Object
						τmp0            λ.Object
						τmp1            λ.Object
						τmp2            λ.Object
					)
					ϒmobj = λ.Cal(Ωre.ϒmatch, λ.GetAttr(ϒself, "_VALID_URL", nil), ϒurl)
					ϒvideo_id = λ.Calm(ϒmobj, "group", λ.StrLiteral("id"))
					ϒurl = λ.Calm(ϒmobj, "group", λ.StrLiteral("url"))
					ϒwebpage = λ.Calm(ϒself, "_download_webpage", ϒurl, ϒvideo_id)
					τmp0 = λ.Mul(λ.NewList(λ.None), λ.IntLiteral(11))
					ϒvideo_url = λ.GetItem(τmp0, λ.IntLiteral(0))
					ϒdescription = λ.GetItem(τmp0, λ.IntLiteral(1))
					ϒthumbnail = λ.GetItem(τmp0, λ.IntLiteral(2))
					ϒtimestamp = λ.GetItem(τmp0, λ.IntLiteral(3))
					ϒuploader = λ.GetItem(τmp0, λ.IntLiteral(4))
					ϒuploader_id = λ.GetItem(τmp0, λ.IntLiteral(5))
					ϒlike_count = λ.GetItem(τmp0, λ.IntLiteral(6))
					ϒcomment_count = λ.GetItem(τmp0, λ.IntLiteral(7))
					ϒcomments = λ.GetItem(τmp0, λ.IntLiteral(8))
					ϒheight = λ.GetItem(τmp0, λ.IntLiteral(9))
					ϒwidth = λ.GetItem(τmp0, λ.IntLiteral(10))
					ϒshared_data = λ.Call(λ.GetAttr(ϒself, "_parse_json", nil), λ.NewArgs(
						λ.Call(λ.GetAttr(ϒself, "_search_regex", nil), λ.NewArgs(
							λ.StrLiteral("window\\._sharedData\\s*=\\s*({.+?});"),
							ϒwebpage,
							λ.StrLiteral("shared data"),
						), λ.KWArgs{
							{Name: "default", Value: λ.StrLiteral("{}")},
						}),
						ϒvideo_id,
					), λ.KWArgs{
						{Name: "fatal", Value: λ.False},
					})
					if λ.IsTrue(ϒshared_data) {
						ϒmedia = λ.Cal(ϒtry_get, ϒshared_data, λ.NewTuple(
							λ.NewFunction("<lambda>",
								[]λ.Param{
									{Name: "x"},
								},
								0, false, false,
								func(λargs []λ.Object) λ.Object {
									var (
										ϒx = λargs[0]
									)
									return λ.GetItem(λ.GetItem(λ.GetItem(λ.GetItem(λ.GetItem(ϒx, λ.StrLiteral("entry_data")), λ.StrLiteral("PostPage")), λ.IntLiteral(0)), λ.StrLiteral("graphql")), λ.StrLiteral("shortcode_media"))
								}),
							λ.NewFunction("<lambda>",
								[]λ.Param{
									{Name: "x"},
								},
								0, false, false,
								func(λargs []λ.Object) λ.Object {
									var (
										ϒx = λargs[0]
									)
									return λ.GetItem(λ.GetItem(λ.GetItem(λ.GetItem(ϒx, λ.StrLiteral("entry_data")), λ.StrLiteral("PostPage")), λ.IntLiteral(0)), λ.StrLiteral("media"))
								}),
						), λ.DictType)
						if λ.IsTrue(ϒmedia) {
							ϒvideo_url = λ.Calm(ϒmedia, "get", λ.StrLiteral("video_url"))
							ϒheight = λ.Cal(ϒint_or_none, λ.Calm(λ.Calm(ϒmedia, "get", λ.StrLiteral("dimensions"), λ.DictLiteral(map[λ.Object]λ.Object{})), "get", λ.StrLiteral("height")))
							ϒwidth = λ.Cal(ϒint_or_none, λ.Calm(λ.Calm(ϒmedia, "get", λ.StrLiteral("dimensions"), λ.DictLiteral(map[λ.Object]λ.Object{})), "get", λ.StrLiteral("width")))
							ϒdescription = func() λ.Object {
								if λv := λ.Cal(ϒtry_get, ϒmedia, λ.NewFunction("<lambda>",
									[]λ.Param{
										{Name: "x"},
									},
									0, false, false,
									func(λargs []λ.Object) λ.Object {
										var (
											ϒx = λargs[0]
										)
										return λ.GetItem(λ.GetItem(λ.GetItem(λ.GetItem(λ.GetItem(ϒx, λ.StrLiteral("edge_media_to_caption")), λ.StrLiteral("edges")), λ.IntLiteral(0)), λ.StrLiteral("node")), λ.StrLiteral("text"))
									}), ϒcompat_str); λ.IsTrue(λv) {
									return λv
								} else {
									return λ.Calm(ϒmedia, "get", λ.StrLiteral("caption"))
								}
							}()
							ϒthumbnail = λ.Calm(ϒmedia, "get", λ.StrLiteral("display_src"))
							ϒtimestamp = λ.Cal(ϒint_or_none, func() λ.Object {
								if λv := λ.Calm(ϒmedia, "get", λ.StrLiteral("taken_at_timestamp")); λ.IsTrue(λv) {
									return λv
								} else {
									return λ.Calm(ϒmedia, "get", λ.StrLiteral("date"))
								}
							}())
							ϒuploader = λ.Calm(λ.Calm(ϒmedia, "get", λ.StrLiteral("owner"), λ.DictLiteral(map[λ.Object]λ.Object{})), "get", λ.StrLiteral("full_name"))
							ϒuploader_id = λ.Calm(λ.Calm(ϒmedia, "get", λ.StrLiteral("owner"), λ.DictLiteral(map[λ.Object]λ.Object{})), "get", λ.StrLiteral("username"))
							ϒget_count = λ.NewFunction("get_count",
								[]λ.Param{
									{Name: "key"},
									{Name: "kind"},
								},
								0, false, false,
								func(λargs []λ.Object) λ.Object {
									var (
										ϒkey  = λargs[0]
										ϒkind = λargs[1]
									)
									return λ.Cal(ϒint_or_none, λ.Cal(ϒtry_get, ϒmedia, λ.NewTuple(
										λ.NewFunction("<lambda>",
											[]λ.Param{
												{Name: "x"},
											},
											0, false, false,
											func(λargs []λ.Object) λ.Object {
												var (
													ϒx = λargs[0]
												)
												return λ.GetItem(λ.GetItem(ϒx, λ.Mod(λ.StrLiteral("edge_media_%s"), ϒkey)), λ.StrLiteral("count"))
											}),
										λ.NewFunction("<lambda>",
											[]λ.Param{
												{Name: "x"},
											},
											0, false, false,
											func(λargs []λ.Object) λ.Object {
												var (
													ϒx = λargs[0]
												)
												return λ.GetItem(λ.GetItem(ϒx, λ.Mod(λ.StrLiteral("%ss"), ϒkind)), λ.StrLiteral("count"))
											}),
									)))
								})
							ϒlike_count = λ.Cal(ϒget_count, λ.StrLiteral("preview_like"), λ.StrLiteral("like"))
							ϒcomment_count = λ.Cal(ϒget_count, λ.StrLiteral("to_comment"), λ.StrLiteral("comment"))
							ϒcomments = λ.Cal(λ.ListType, λ.Cal(λ.NewFunction("<generator>",
								nil,
								0, false, false,
								func(λargs []λ.Object) λ.Object {
									return λ.NewGenerator(func(λgy λ.Yielder) λ.Object {
										var (
											ϒcomment λ.Object
											τmp0     λ.Object
											τmp1     λ.Object
										)
										τmp0 = λ.Cal(λ.BuiltinIter, λ.Calm(λ.Calm(ϒmedia, "get", λ.StrLiteral("comments"), λ.DictLiteral(map[λ.Object]λ.Object{})), "get", λ.StrLiteral("nodes"), λ.NewList()))
										for {
											if τmp1 = λ.NextDefault(τmp0, λ.AfterLast); τmp1 == λ.AfterLast {
												break
											}
											ϒcomment = τmp1
											if λ.IsTrue(λ.Calm(ϒcomment, "get", λ.StrLiteral("text"))) {
												λgy.Yield(λ.DictLiteral(map[string]λ.Object{
													"author":    λ.Calm(λ.Calm(ϒcomment, "get", λ.StrLiteral("user"), λ.DictLiteral(map[λ.Object]λ.Object{})), "get", λ.StrLiteral("username")),
													"author_id": λ.Calm(λ.Calm(ϒcomment, "get", λ.StrLiteral("user"), λ.DictLiteral(map[λ.Object]λ.Object{})), "get", λ.StrLiteral("id")),
													"id":        λ.Calm(ϒcomment, "get", λ.StrLiteral("id")),
													"text":      λ.Calm(ϒcomment, "get", λ.StrLiteral("text")),
													"timestamp": λ.Cal(ϒint_or_none, λ.Calm(ϒcomment, "get", λ.StrLiteral("created_at"))),
												}))
											}
										}
										return λ.None
									})
								})))
							if !λ.IsTrue(ϒvideo_url) {
								ϒedges = func() λ.Object {
									if λv := λ.Cal(ϒtry_get, ϒmedia, λ.NewFunction("<lambda>",
										[]λ.Param{
											{Name: "x"},
										},
										0, false, false,
										func(λargs []λ.Object) λ.Object {
											var (
												ϒx = λargs[0]
											)
											return λ.GetItem(λ.GetItem(ϒx, λ.StrLiteral("edge_sidecar_to_children")), λ.StrLiteral("edges"))
										}), λ.ListType); λ.IsTrue(λv) {
										return λv
									} else {
										return λ.NewList()
									}
								}()
								if λ.IsTrue(ϒedges) {
									ϒentries = λ.NewList()
									τmp0 = λ.Cal(λ.BuiltinIter, λ.Call(λ.EnumerateIteratorType, λ.NewArgs(ϒedges), λ.KWArgs{
										{Name: "start", Value: λ.IntLiteral(1)},
									}))
									for {
										if τmp1 = λ.NextDefault(τmp0, λ.AfterLast); τmp1 == λ.AfterLast {
											break
										}
										τmp2 = τmp1
										ϒedge_num = λ.GetItem(τmp2, λ.IntLiteral(0))
										ϒedge = λ.GetItem(τmp2, λ.IntLiteral(1))
										ϒnode = λ.Cal(ϒtry_get, ϒedge, λ.NewFunction("<lambda>",
											[]λ.Param{
												{Name: "x"},
											},
											0, false, false,
											func(λargs []λ.Object) λ.Object {
												var (
													ϒx = λargs[0]
												)
												return λ.GetItem(ϒx, λ.StrLiteral("node"))
											}), λ.DictType)
										if !λ.IsTrue(ϒnode) {
											continue
										}
										ϒnode_video_url = λ.Cal(ϒurl_or_none, λ.Calm(ϒnode, "get", λ.StrLiteral("video_url")))
										if !λ.IsTrue(ϒnode_video_url) {
											continue
										}
										λ.Calm(ϒentries, "append", λ.DictLiteral(map[string]λ.Object{
											"id": func() λ.Object {
												if λv := λ.Calm(ϒnode, "get", λ.StrLiteral("shortcode")); λ.IsTrue(λv) {
													return λv
												} else {
													return λ.GetItem(ϒnode, λ.StrLiteral("id"))
												}
											}(),
											"title":     λ.Mod(λ.StrLiteral("Video %d"), ϒedge_num),
											"url":       ϒnode_video_url,
											"thumbnail": λ.Calm(ϒnode, "get", λ.StrLiteral("display_url")),
											"width": λ.Cal(ϒint_or_none, λ.Cal(ϒtry_get, ϒnode, λ.NewFunction("<lambda>",
												[]λ.Param{
													{Name: "x"},
												},
												0, false, false,
												func(λargs []λ.Object) λ.Object {
													var (
														ϒx = λargs[0]
													)
													return λ.GetItem(λ.GetItem(ϒx, λ.StrLiteral("dimensions")), λ.StrLiteral("width"))
												}))),
											"height": λ.Cal(ϒint_or_none, λ.Cal(ϒtry_get, ϒnode, λ.NewFunction("<lambda>",
												[]λ.Param{
													{Name: "x"},
												},
												0, false, false,
												func(λargs []λ.Object) λ.Object {
													var (
														ϒx = λargs[0]
													)
													return λ.GetItem(λ.GetItem(ϒx, λ.StrLiteral("dimensions")), λ.StrLiteral("height"))
												}))),
											"view_count": λ.Cal(ϒint_or_none, λ.Calm(ϒnode, "get", λ.StrLiteral("video_view_count"))),
										}))
									}
									return λ.Calm(ϒself, "playlist_result", ϒentries, ϒvideo_id, func() λ.Object {
										if λ.IsTrue(ϒuploader_id) {
											return λ.Mod(λ.StrLiteral("Post by %s"), ϒuploader_id)
										} else {
											return λ.None
										}
									}(), ϒdescription)
								}
							}
						}
					}
					if !λ.IsTrue(ϒvideo_url) {
						ϒvideo_url = λ.Call(λ.GetAttr(ϒself, "_og_search_video_url", nil), λ.NewArgs(ϒwebpage), λ.KWArgs{
							{Name: "secure", Value: λ.False},
						})
					}
					ϒformats = λ.NewList(λ.DictLiteral(map[string]λ.Object{
						"url":    ϒvideo_url,
						"width":  ϒwidth,
						"height": ϒheight,
					}))
					if !λ.IsTrue(ϒuploader_id) {
						ϒuploader_id = λ.Call(λ.GetAttr(ϒself, "_search_regex", nil), λ.NewArgs(
							λ.StrLiteral("\"owner\"\\s*:\\s*{\\s*\"username\"\\s*:\\s*\"(.+?)\""),
							ϒwebpage,
							λ.StrLiteral("uploader id"),
						), λ.KWArgs{
							{Name: "fatal", Value: λ.False},
						})
					}
					if !λ.IsTrue(ϒdescription) {
						ϒdescription = λ.Call(λ.GetAttr(ϒself, "_search_regex", nil), λ.NewArgs(
							λ.StrLiteral("\"caption\"\\s*:\\s*\"(.+?)\""),
							ϒwebpage,
							λ.StrLiteral("description"),
						), λ.KWArgs{
							{Name: "default", Value: λ.None},
						})
						if ϒdescription != λ.None {
							ϒdescription = λ.Cal(ϒlowercase_escape, ϒdescription)
						}
					}
					if !λ.IsTrue(ϒthumbnail) {
						ϒthumbnail = λ.Calm(ϒself, "_og_search_thumbnail", ϒwebpage)
					}
					return λ.DictLiteral(map[string]λ.Object{
						"id":            ϒvideo_id,
						"formats":       ϒformats,
						"ext":           λ.StrLiteral("mp4"),
						"title":         λ.Mod(λ.StrLiteral("Video by %s"), ϒuploader_id),
						"description":   ϒdescription,
						"thumbnail":     ϒthumbnail,
						"timestamp":     ϒtimestamp,
						"uploader_id":   ϒuploader_id,
						"uploader":      ϒuploader,
						"like_count":    ϒlike_count,
						"comment_count": ϒcomment_count,
						"comments":      ϒcomments,
					})
				})
			return λ.DictLiteral(map[string]λ.Object{
				"_VALID_URL":    InstagramIE__VALID_URL,
				"_real_extract": InstagramIE__real_extract,
			})
		}())
		InstagramPlaylistIE = λ.Cal(λ.TypeType, λ.StrLiteral("InstagramPlaylistIE"), λ.NewTuple(InfoExtractor), func() λ.Dict {

			return λ.DictLiteral(map[λ.Object]λ.Object{})
		}())
		InstagramUserIE = λ.Cal(λ.TypeType, λ.StrLiteral("InstagramUserIE"), λ.NewTuple(InstagramPlaylistIE), func() λ.Dict {
			var (
				InstagramUserIE__VALID_URL λ.Object
			)
			InstagramUserIE__VALID_URL = λ.StrLiteral("https?://(?:www\\.)?instagram\\.com/(?P<id>[^/]{2,})/?(?:$|[?#])")
			return λ.DictLiteral(map[string]λ.Object{
				"_VALID_URL": InstagramUserIE__VALID_URL,
			})
		}())
		InstagramTagIE = λ.Cal(λ.TypeType, λ.StrLiteral("InstagramTagIE"), λ.NewTuple(InstagramPlaylistIE), func() λ.Dict {
			var (
				InstagramTagIE__VALID_URL λ.Object
			)
			InstagramTagIE__VALID_URL = λ.StrLiteral("https?://(?:www\\.)?instagram\\.com/explore/tags/(?P<id>[^/]+)")
			return λ.DictLiteral(map[string]λ.Object{
				"_VALID_URL": InstagramTagIE__VALID_URL,
			})
		}())
	})
}
